<!DOCTYPE html>
<html>
<head>

	<title>GeoJSON tutorial - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js" integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg==" crossorigin=""></script>


	<style>
			#map { position:absolute; top:0; bottom:0; width:100%; }
	</style>


</head>
<body>

<div id='map'></div>

<script src="js/2017_05_13GRORecommendationsMatricesBranches.js" type="text/javascript"></script>

<script type="text/javascript">
	var map = L.map('map').setView([44.9, -93], 10);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.light'
	}).addTo(map);

	var divestBranchIcon = L.icon({
		iconUrl: 'images/branch_divest.png',
		iconSize: [32, 37],
		iconAnchor: [16, 37],
		popupAnchor: [0, -28]
	});
	var holdBranchIcon = L.icon({
		iconUrl: 'images/branch_hold.png',
		iconSize: [32, 37],
		iconAnchor: [16, 37],
		popupAnchor: [0, -28]
	});
	var investBranchIcon = L.icon({
		iconUrl: 'images/branch_invest.png',
		iconSize: [32, 37],
		iconAnchor: [16, 37],
		popupAnchor: [0, -28]
	});
/*
	function onEachFeature(feature, layer) {

		if (feature.properties && feature.properties.INVESTMENT_NOTES) {
			var popupContent = feature.properties.INVESTMENT_NOTES;
		}


		layer.bindPopup(popupContent);
	}

	var branchesLayer = L.geoJSON(branches, {

		pointToLayer: function (feature, latlng) {

			return L.marker(latlng, {icon: investBranchIcon});
		},

		onEachFeature: onEachFeature
	}).addTo(map);
*/

var branchesLayer = L.geoJson(branches,{
    onEachFeature:onEachFeature
});

function onEachFeature(feature, layer) {

    var lon = feature.geometry.coordinates[0];
    var lat = feature.geometry.coordinates[1];

    var popupContent;
    var marker;
		popupContent = "Proj. Budget: " + feature.properties.PROJ_BUDGET;
		popupContent += "<br />&#8710; Units: " + feature.properties.Change_UNITS;
		popupContent += "<br />&#8710; Mem. Revenue: " + feature.properties.CHANGE_MEM_REVENUE;
		popupContent += "<br />Cost / Unit: " + feature.properties.COST_UNIT;
		popupContent += "<br />Notes: " + feature.properties.INVESTMENT_NOTES;
    switch(feature.properties.ICON) {
        case "investBranchIcon":
            marker = L.marker([lat, lon], {icon: investBranchIcon}).addTo(map);
            break;
        case "divestBranchIcon":
            marker = L.marker([lat, lon], {icon: divestBranchIcon}).addTo(map);
						popupContent += "Position: " + feature.properties.POSITION;
            break;
        default:
            marker = L.marker([lat, lon], {icon: holdBranchIcon}).addTo(map);

    }

    marker.bindPopup(popupContent);
}


</script>



</body>
</html>
